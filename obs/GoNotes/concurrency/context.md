–í –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç (context) ‚Äî —ç—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥–µ, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –æ–±—ä–µ–∫—Ç –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è. –í Go –ø–æ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç –≤ –≤–∏–¥—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Context –∏–∑ –ø–∞–∫–µ—Ç–∞ context. –ò—Å—Ö–æ–¥–Ω–æ –µ–≥–æ –ø—Ä–∏–¥—É–º–∞–ª–∏, —á—Ç–æ–±—ã –æ–±–ª–µ–≥—á–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å HTTP-–∑–∞–ø—Ä–æ—Å–∞–º–∏. –ù–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –≤ –æ–±—ã—á–Ω–æ–º –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ–º –∫–æ–¥–µ. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ.

## –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª
–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ñ—É–Ω–∫—Ü–∏—é execute(), –∫–æ—Ç–æ—Ä–∞—è —É–º–µ–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–º–µ–Ω—É:
```go
func execute(cancel <-chan struct{}, fn func() int) (int, error) {
    ch := make(chan int, 1)

    go func() {
        ch <- fn()
    }()

    select {
    case res := <-ch:
        return res, nil
    case <-cancel:
        return 0, errors.New("canceled")
    }
}
```
–ó–¥–µ—Å—å –≤—Å–µ –∑–Ω–∞–∫–æ–º–æ:

- —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–Ω–∞–ª, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—ã;
- –∑–∞–ø—É—Å–∫–∞–µ—Ç fn() –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ;
- —á–µ—Ä–µ–∑ select –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è fn() –ª–∏–±–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –æ—Ç–º–µ–Ω–µ, —Å–º–æ—Ç—Ä—è —á—Ç–æ –Ω–∞—Å—Ç—É–ø–∏—Ç —Ä–∞–Ω—å—à–µ.

–ù–∞–ø–∏—à–µ–º –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —Å 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é:
```go
func main() {
    rand.Seed(time.Now().Unix())

    // —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 100 –º—Å
    work := func() int {
        time.Sleep(100 * time.Millisecond)
        fmt.Println("work done")
        return 42
    }

    // –∂–¥–µ—Ç 50 –º—Å, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ
    // —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 50% –æ—Ç–º–µ–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É
    maybeCancel := func(cancel chan struct{}) {
        time.Sleep(50 * time.Millisecond)
        if rand.Float32() < 0.5 {
            close(cancel)
        }
    }

    cancel := make(chan struct{})

    go maybeCancel(cancel)

    res, err := execute(cancel, work)
    fmt.Println(res, err)
}
```
–ê —Ç–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

# –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç
–û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ Go ‚Äî –æ—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π.

–ü–æ–≤—Ç–æ—Ä–∏–º —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–æ, —á—Ç–æ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–¥–µ–ª–∞–ª–∏ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª –æ—Ç–º–µ–Ω—ã. –§—É–Ω–∫—Ü–∏—è execute() –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç ctx –≤–º–µ—Å—Ç–æ –∫–∞–Ω–∞–ª–∞ cancel:

```go
// –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é fn —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ctx
func execute(ctx context.Context, fn func() int) (int, error) {
    ch := make(chan int, 1)

    go func() {
        ch <- fn()
    }()

    select {
    case res := <-ch:
        return res, nil
    case <-ctx.Done():       // (1)
        return 0, ctx.Err()  // (2)
    }
}
```
–ö–æ–¥ –ø–æ—á—Ç–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è:
- –≤–º–µ—Å—Ç–æ –∫–∞–Ω–∞–ª–∞ cancel —Å–∏–≥–Ω–∞–ª –æ–± –æ—Ç–º–µ–Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –∏–∑ –∫–∞–Ω–∞–ª–∞ ctx.Done() ‚ûä
- –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º ctx.Err() ‚ûã

–ö–ª–∏–µ–Ω—Ç —Ç–æ–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω—è–µ—Ç—Å—è:
```go
func main() {
    // ...
    
    // —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 100 –º—Å
    work := func() int {
        // ...
    }

    // –∂–¥–µ—Ç 50 –º—Å, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ
    // —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 50% –æ—Ç–º–µ–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É
    maybeCancel := func(cancel func()) {
        time.Sleep(50 * time.Millisecond)
        if rand.Float32() < 0.5 {
            cancel()
        }
    }

    ctx := context.Background()              // (1)
    ctx, cancel := context.WithCancel(ctx)   // (2)
    defer cancel()                           // (3)

    go maybeCancel(cancel)                   // (4)

    res, err := execute(ctx, work)           // (5)
    fmt.Println(res, err)
}
```
–í–æ—Ç —á—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

‚ûä —á–µ—Ä–µ–∑ context.Background() —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç;

‚ûã —á–µ—Ä–µ–∑ context.WithCancel() –Ω–∞ –±–∞–∑–µ –ø—É—Å—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä—É—á–Ω–æ–π –æ—Ç–º–µ–Ω—ã;

‚ûå –ø–ª–∞–Ω–∏—Ä—É–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –æ—Ç–º–µ–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ main();

‚ûç –æ—Ç–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é;

‚ûé –ø–µ—Ä–µ–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é execute().

context.WithCancel() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∞–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ñ—É–Ω–∫—Ü–∏—é cancel –¥–ª—è –µ–≥–æ –æ—Ç–º–µ–Ω—ã. –í—ã–∑–æ–≤ cancel() –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∑–∞–Ω—è—Ç—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ä–µ—Å—É—Ä—Å—ã –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª ctx.Done() ‚Äî —ç—Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç –º—ã –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è execute(). –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–º–µ–Ω–µ–Ω, —Ç–æ ctx.Err() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É —Å –ø—Ä–∏—á–∏–Ω–æ–π –æ—Ç–º–µ–Ω—ã (context.Canceled –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ).

### –ö–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî —ç—Ç–æ –º–∞—Ç—Ä–µ—à–∫–∞. 
–û–±—ä–µ–∫—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π. –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –Ω–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞, —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (¬´–¥–æ—á–µ—Ä–Ω–∏–π¬ª) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ä–æ–≥–æ (¬´—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ¬ª). –ü–æ—ç—Ç–æ–º—É –º—ã —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–ª–∏ –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∞ –∑–∞—Ç–µ–º –Ω–æ–≤—ã–π (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã) –Ω–∞ –µ–≥–æ –æ—Å–Ω–æ–≤–µ:
```go
// —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
ctx := context.Background()

// –¥–æ—á–µ—Ä–Ω–∏–π
ctx, cancel := context.WithCancel(ctx)
–ï—Å–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –æ—Ç–º–µ–Ω—è—Ç—Å—è –∏ –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ (–Ω–æ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç).

// —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
parentCtx, parentCancel := context.WithCancel(context.Background())

// –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
childCtx, childCancel := context.WithCancel(parentCtx)

// parentCancel() –æ—Ç–º–µ–Ω–∏—Ç parentCtx –∏ childCtx
// childCancel() –æ—Ç–º–µ–Ω–∏—Ç —Ç–æ–ª—å–∫–æ childCtx
```

–ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–∞—è –æ—Ç–º–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞. –ï—Å–ª–∏ –¥–≤–∞ —Ä–∞–∑–∞ –≤—ã–∑–≤–∞—Ç—å close() –Ω–∞ –∫–∞–Ω–∞–ª–µ, –ø–æ–ª—É—á–∏–º –ø–∞–Ω–∏–∫—É. –ê –≤–æ—Ç –≤—ã–∑—ã–≤–∞—Ç—å cancel() –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–∂–Ω–æ —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ. –ü–µ—Ä–≤–∞—è –æ—Ç–º–µ–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±—É–¥—É—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π cancel(), –ø–ª—é—Å —è–≤–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–∫–∞–∫ –º—ã —Å–¥–µ–ª–∞–ª–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ maybeCancel). –° –∫–∞–Ω–∞–ª–æ–º –±—ã —Ç–∞–∫ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å.

# –¢–∞–π–º–∞—É—Ç
–ù–∞—Å—Ç–æ—è—â–∞—è —Å–∏–ª–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Ç–æ–º, —á—Ç–æ –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–º–µ–Ω—ã, —Ç–∞–∫ –∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã –ø–æ —Ç–∞–π–º–∞—É—Ç—É. –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä—É–∫–∞–º–∏:

```go
func execute(ctx context.Context, fn func() int) (int, error) {
    // –∫–æ–¥ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
}

func main() {
    // ...

    // —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 100 –º—Å
    work := func() int {
        // ...
    }

    // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö
    randomChoice := func(arg ...int) int {
        i := rand.Intn(len(arg))
        return arg[i]
    }

    // —Å–ª—É—á–∞–π–Ω—ã–π —Ç–∞–π–º–∞—É—Ç - 50 –º—Å –ª–∏–±–æ 150 –º—Å
    timeout := time.Duration(randomChoice(50, 150)) * time.Millisecond
    ctx, cancel := context.WithTimeout(context.Background(), timeout)    // (1)
    defer cancel()

    res, err := execute(ctx, work)
    fmt.Println(res, err)
}
```

–§—É–Ω–∫—Ü–∏—è execute() –≤–æ–æ–±—â–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –∞ –≤ main() –≤–º–µ—Å—Ç–æ context.WithCancel() —Ç–µ–ø–µ—Ä—å context.WithTimeout() ‚ûä. –≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã execute() —Ç–µ–ø–µ—Ä—å –æ—Ç–≤–∞–ª–∏–≤–∞–ª–∞—Å—å –ø–æ —Ç–∞–π–º–∞—É—Ç—É –≤ –ø–æ–ª–æ–≤–∏–Ω–µ —Å–ª—É—á–∞–µ–≤ (–æ—à–∏–±–∫–∞ context.DeadlineExceeded):

–ö–ª–∞—Å—Å–Ω–æ, –≤–æ—Ç —Ç–≤–æ–π —Ç–µ–∫—Å—Ç –≤ Markdown:

---

## –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∏ –¥–æ—á–µ—Ä–Ω–∏–π —Ç–∞–π–º–∞—É—Ç—ã

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å–µ —Ç–∞ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è `execute()` –∏ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å ‚Äî –±—ã—Å—Ç—Ä–∞—è `work()` –∏ –º–µ–¥–ª–µ–Ω–Ω–∞—è `slow()`:

```go
// –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é fn —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ctx
func execute(ctx context.Context, fn func() int) (int, error) {
    ch := make(chan int, 1)

    go func() {
        ch <- fn()
    }()

    select {
    case res := <-ch:
        return res, nil
    case <-ctx.Done():
        return 0, ctx.Err()
    }
}

// —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 100 –º—Å
work := func() int {
    time.Sleep(100 * time.Millisecond)
    return 42
}

// —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 300 –º—Å
slow := func() int {
    time.Sleep(300 * time.Millisecond)
    return 13
}
```

–ü—É—Å—Ç—å —Ç–∞–π–º–∞—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 200 –º—Å:

```go
// –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —É–º–æ–ª—á–∞—Ç–µ–ª—å–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º 200 –º—Å
getDefaultCtx := func() (context.Context, context.CancelFunc) {
    const timeout = 200 * time.Millisecond
    return context.WithTimeout(context.Background(), timeout)
}
```

–¢–æ–≥–¥–∞ `work()` —Å —É–º–æ–ª—á–∞—Ç–µ–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è:

```go
// —Ç–∞–π–º–∞—É—Ç 200 –º—Å
ctx, cancel := getDefaultCtx()
defer cancel()

// —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
res, err := execute(ctx, work)
fmt.Println(res, err) // 42 <nil>
```

–ê `slow()` ‚Äî –Ω–µ —É—Å–ø–µ–µ—Ç:

```go
// —Ç–∞–π–º–∞—É—Ç 200 –º—Å
ctx, cancel := getDefaultCtx()
defer cancel()

// –ù–ï —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
res, err := execute(ctx, slow)
fmt.Println(res, err) // 0 context deadline exceeded
```

–ú—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –±–æ–ª–µ–µ –∂–µ—Å—Ç–∫–∏–π —Ç–∞–π–º–∞—É—Ç. –¢–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∏–º–µ–Ω–Ω–æ –æ–Ω, –∞ –Ω–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π:

```go
// —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º 200 –º—Å
parentCtx, cancel := getDefaultCtx()
defer cancel()

// –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º 50 –º—Å
childCtx, cancel := context.WithTimeout(parentCtx, 50*time.Millisecond)
defer cancel()

// —Ç–µ–ø–µ—Ä—å work –ù–ï —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
res, err := execute(childCtx, work)
fmt.Println(res, err) // 0 context deadline exceeded
```

–ê –µ—Å–ª–∏ —Å–æ–∑–¥–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –±–æ–ª–µ–µ –º—è–≥–∫–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º ‚Äî –æ–Ω –æ–∫–∞–∂–µ—Ç—Å—è –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω. –¢–∞–π–º–∞—É—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–Ω—å—à–µ:

```go
// —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º 200 –º—Å
parentCtx, cancel := getDefaultCtx()
defer cancel()

// –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º 500 –º—Å
childCtx, cancel := context.WithTimeout(parentCtx, 500*time.Millisecond)
defer cancel()

// slow –≤—Å–µ —Ä–∞–≤–Ω–æ –ù–ï —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
res, err := execute(childCtx, slow)
fmt.Println(res, err) // 0 context deadline exceeded
```

–ü–æ–ª—É—á–∞–µ—Ç—Å—è –≤–æ—Ç —á—Ç–æ:

- –ò–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤, –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∏ –¥–æ—á–µ—Ä–Ω–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏, –≤—Å–µ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–æ–ª–µ–µ –∂–µ—Å—Ç–∫–∏–π.
- –î–æ—á–µ—Ä–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ —É–∂–µ—Å—Ç–æ—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ, –Ω–æ –Ω–µ –æ—Å–ª–∞–±–∏—Ç—å –µ–≥–æ.

--- 

–ù–∞–¥–µ—é—Å—å, —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤ –ø–æ–Ω–∏–º–∞–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ –≤ Go! üë©‚ÄçüíªüöÄ

–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é! –í–æ—Ç —Ç–µ–∫—Å—Ç –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤ Go:

---

## –î–µ–¥–ª–∞–π–Ω

–ü–æ–º–∏–º–æ —Ç–∞–π–º–∞—É—Ç–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ–¥–ª–∞–π–Ω (deadline) ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –Ω–µ —á–µ—Ä–µ–∑ N —Å–µ–∫—É–Ω–¥, –∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.

```go
// –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é fn —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ctx
func execute(ctx context.Context, fn func() int) (int, error) {
    // –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}

func main() {
    // ...

    // —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 100 –º—Å
    work := func() int {
        // ...
    }

    // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö
    randomChoice := func(arg ...int) int {
        // ...
    }

    // —Å–ª—É—á–∞–π–Ω—ã–π –¥–µ–¥–ª–∞–π–Ω - +50 –º—Å –ª–∏–±–æ +150 –º—Å
    // –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    timeout := time.Duration(randomChoice(50, 150)) * time.Millisecond
    deadline := time.Now().Add(timeout)
    ctx, cancel := context.WithDeadline(context.Background(), deadline)  // (1)
    defer cancel()

    res, err := execute(ctx, work)
    fmt.Println(res, err)
}

// –ø—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞
// work –≤—ã–ø–æ–ª–Ω–µ–Ω
// 42 <nil>

// –¥–µ–¥–ª–∞–π–Ω –ø—Ä–µ–≤—ã—à–µ–Ω
// 0 context deadline exceeded

// –¥–µ–¥–ª–∞–π–Ω –ø—Ä–µ–≤—ã—à–µ–Ω
// 0 context deadline exceeded

// work –≤—ã–ø–æ–ª–Ω–µ–Ω
// 42 <nil>

// –ø–µ—Å–æ—á–Ω–∏—Ü–∞
```

–ò–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ `context.WithDeadline()` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ `context.WithTimeout()`, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `time.Time` –≤–º–µ—Å—Ç–æ `time.Duration`.

–ë–æ–ª–µ–µ —Ç–æ–≥–æ, `context.WithTimeout()` —è–≤–ª—è–µ—Ç—Å—è –æ–±–µ—Ä—Ç–∫–æ–π –Ω–∞–¥ `context.WithDeadline()`:

```go
// —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) {
    return WithDeadline(parent, time.Now().Add(timeout))
}
```

–ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–µ–¥–ª–∞–π–Ω–æ–º, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `Deadline()`:

```go
now := time.Now()
fmt.Println(now)
// 2009-11-10 23:00:00

ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)
deadline, ok := ctx.Deadline()
fmt.Println(deadline, ok)
// 2009-11-10 23:00:05 true

plus5s := now.Add(5 * time.Second)
ctx, _ = context.WithDeadline(context.Background(), plus5s)
deadline, ok = ctx.Deadline()
fmt.Println(deadline, ok)
// 2009-11-10 23:00:05 true
```

–í—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `Deadline()` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ –¥–µ–¥–ª–∞–π–Ω:

- –î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `WithTimeout()` –∏ `WithDeadline()`, —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–≤–Ω–æ `true`.
- –î–ª—è `WithCancel()` –∏ `Background()` ‚Äî `false`.

```go
ctx, _ := context.WithCancel(context.Background())
deadline, ok := ctx.Deadline()
fmt.Println(deadline, ok)
// 0001-01-01 00:00:00 false

ctx = context.Background()
deadline, ok = ctx.Deadline()
fmt.Println(deadline, ok)
// 0001-01-01 00:00:00 false
```

–ù–∞–¥–µ—é—Å—å, —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö –≤ Go –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–æ–π –¥–ª—è –≤–∞—Å! üï∞Ô∏èüë©‚ÄçüíªüöÄ

--- 

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –Ω—É–∂–Ω–∞ –¥–∞–ª—å–Ω–µ–π—à–∞—è –ø–æ–º–æ—â—å, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å!
