### ะัะฑะพัะบะฐ ะดะฐะฝะฝัั

ะัะพะดะพะปะถะธะผ ัะฐะฑะพัะฐัั ั ัะฐะฑะปะธัะตะน ะบะฝะธะณ:

```table
โโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโโ
โ id โ           title            โ    author     โ num_pages โ rating โ
โโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโค
โ 1  โ The Catcher in the Rye     โ J.D. Salinger โ 277       โ 3.8    โ
โ 2  โ The Fellowship of the Ring โ J.R.R. Tolkin โ 398       โ 4.36   โ
โ 3  โ The Giver                  โ Lois Lowry    โ 208       โ 4.13   โ
โ 4  โ The Da Vinci Code          โ Dan Brown     โ 489       โ 3.84   โ
โ 5  โ The Alchemist              โ Paulo Coelho  โ 197       โ 3.86   โ
โโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโ```
```

ะงัะพะฑั ะฝะต ัะฐะทะผะฐะทัะฒะฐัั ะธะฝัะพัะผะฐัะธั ะพ ะบะฝะธะณะต ะฟะพ ะฟััะธ ะฟะตัะตะผะตะฝะฝัะผ, ัะพะทะดะฐะดะธะผ ััััะบัััั:

```go
type Book struct {
    id int
    title string
    author string
    numPages int
    rating float64
}
```

ะ ะฒัะฑะตัะตะผ ะฒัะต ะบะฝะธะณะธ ะธะท ะฑะฐะทั:

```go
db, err := sql.Open("sqlite3", "books.db")
// ...

query := "select id, title, author, num_pages, rating from books"
rows, err := db.Query(query)        // (1)
if err != nil {
    panic(err)
}
defer rows.Close()                  // (2)

for rows.Next() {                   // (3)
    var book Book
    err := rows.Scan(&book.id, &book.title, &book.author, &book.numPages, &book.rating)  // (4)
    if err != nil {
        panic(err)
    }
    fmt.Println(book)
}

if err := rows.Err(); err != nil {  // (5)
    panic(err)
}
```

ะะพั ััะพ ะทะดะตัั ะฟัะพะธััะพะดะธั:

1. ะงะตัะตะท `DB.Query()` ะฒัะฟะพะปะฝัะตะผ select-ะทะฐะฟัะพั ะธ ะฟะพะปััะฐะตะผ ัะบะฐะทะฐัะตะปั ะฝะฐ ัะตะทัะปััะฐั `sql.Rows`
2. ะงะตัะตะท `Rows.Close()` ะณะฐัะฐะฝัะธััะตะผ, ััะพ ะพัะฒะพะฑะพะดะธะผ ัะตััััั, ะทะฐะฝัััะต ัะตะทัะปััะฐัะฐะผะธ.
3. ะงะตัะตะท `Rows.Next()` ะฟัะพัะพะดะธะผ ะฟะพ ัััะพะบะฐะผ ัะตะทัะปััะฐัะฐ. ะัะปะธ ัััะพะบ ะฝะต ะพััะฐะปะพัั, ะพะฝ ะฒะตัะฝะตั `false`.
4. ะงะตัะตะท `Rows.Scan()` cัะธััะฒะฐะตะผ ะฟะพะปั ัะตะบััะตะน ัััะพะบะธ ะฒ ะฟะพะปั ััััะบัััั.
5. ะงะตัะตะท `Rows.Err()` ะฟัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต ะพัะธะฑะพะบ ะฒ ัะตะทัะปััะฐัะต.

`Rows.Scan()` ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะตะพะฑัะฐะทัะตั ัะธะฟั ะดะฐะฝะฝัั ะกะฃะะ ะฒ ัะธะฟั Go. ะะพะดะดะตัะถะธะฒะฐัััั `int`, `string`, `float64`, `bool`
, `[]byte` ะธ ะฝะตะบะพัะพััะต ะดััะณะธะต.

ะัะปะธ ะทะฐะฟัะพั ะฒ ัะตะปะพะผ ะฝะต ะพััะฐะฑะพัะฐะป, ัะพ ะฟะตัะฒัะน ะถะต ะฒัะทะพะฒ `Rows.Next()` ะฒะตัะฝะตั `false`, ัะฐะบ ััะพ ะฒะฝัััั ัะธะบะปะฐ ะผั ะฝะต ะฟะพะฟะฐะดะตะผ.
ะัะปะพะฒะธัั ัะฐะบะธะต ะพัะธะฑะบะธ ะฟะพะผะพะถะตั ัะปะตะดัััะฐั ะฟัะพะฒะตัะบะฐ ะฝะฐ `Rows.Err()`.

ะะตะทัะปััะฐั:

```http
{1 The Catcher in the Rye J.D. Salinger 277 3.8} {2 The Fellowship of the Ring J.R.R. Tolkin 398 4.36} {3 The Giver Lois Lowry 208 4.13} {4 The Da Vinci Code Dan Brown 489 3.84} {5 The Alchemist Paulo Coelho 197 3.86}
```

### ะะฝัะพัะผะฐัะธั ะพ ััะพะปะฑัะฐั

ะะตัะพะดั `Rows.Columns()` ะธ `Rows.ColumnTypes()` ะฒะพะทะฒัะฐัะฐัั ะธะฝัะพัะผะฐัะธั ะพ ััะพะปะฑัะฐั ัะตะทัะปััะฐัะฐ:

```go
func main(() {
    // ...
    query := "select id, title, author, num_pages, rating from books"
    rows, err := db.Query(query)
    // ...

    names, err := rows.Columns()         // (1)
    fmt.Println(names)

    colTypes, err := rows.ColumnTypes()  // (2)
    for idx, col := range colTypes {
        printColumn(idx, col)
    }
}

func printColumn(idx int, col *sql.ColumnType) {
    fmt.Printf("#%v: name=%v", idx, col.Name())
    if nullable, ok := col.Nullable(); ok {
        fmt.Printf(", nullable=%v", nullable)
    }
    if length, ok := col.Length(); ok {
        fmt.Printf(", length=%v", length)
    }
    if precision, scale, ok := col.DecimalSize(); ok {
        fmt.Printf(", precision/scale=%v/%v", precision, scale)
    }
    fmt.Println()
}
```

```http
[id title author num_pages rating] #0: name=id, nullable=true #1: name=title, nullable=true #2: name=author, nullable=true #3: name=num_pages, nullable=true #4: name=rating, nullable=true
```

ะะตัะพะด `Columns()` โ ะฒะพะทะฒัะฐัะฐะตั ััะตะท ั ะฝะฐะทะฒะฐะฝะธัะผะธ ััะพะปะฑัะพะฒ, ะฐ ะผะตัะพะด `ColumnTypes()` โ โ ะฟะพะดัะพะฑะฝัั ะธะฝัะพัะผะฐัะธั ะพ ะบะฐะถะดะพะผ
ััะพะปะฑัะต (`ColumnType`):

- `.Name()` โ ะฝะฐะทะฒะฐะฝะธะต ััะพะปะฑัะฐ;
- `.Nullable()` โ ะดะพะฟััะบะฐะตั ะปะธ null-ะทะฝะฐัะตะฝะธั;
- `.Length()` โ ะผะฐะบัะธะผะฐะปัะฝะฐั ะดะปะธะฝะฐ ะทะฝะฐัะตะฝะธั, ะดะปั ัะตะบััะพะฒัั ะธ ะฑะธะฝะฐัะฝัั ััะพะปะฑัะพะฒ;
- `.DecimalSize()` โ ัะพัะฝะพััั (precision, ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ ะทะฝะฐัะธะผัั ัะธัั ะฒ ัะธัะปะต) ะธ ะผะฐัััะฐะฑ (scale, ะบะพะปะธัะตััะฒะพ
  ะดะตัััะธัะฝัั ัะธัั ะฒ ะดัะพะฑะฝะพะน ัะฐััะธ), ะดะปั ัะธัะปะพะฒัั ััะพะปะฑัะพะฒ.

### ะัะฑะพัะบะฐ ะพะดะฝะพะน ัััะพะบะธ

ะะฝะพะณะดะฐ ะผั ะทะฐัะฐะฝะตะต ะทะฝะฐะตะผ, ััะพ ะพะถะธะดะฐะตะผ ะฒ ัะตะทัะปััะฐัะต ัะพะฒะฝะพ ะพะดะฝั ัััะพะบั. ะะฐะฟัะธะผะตั, ะบะพะณะดะฐ ะฒัะฑะธัะฐะตะผ ะบะฝะธะณั ะฟะพ ะธะดะตะฝัะธัะธะบะฐัะพัั.
ะะปั ัะฐะบะธั ะทะฐะฟัะพัะพะฒ ะฟัะตะดััะผะพััะตะฝ ะพัะดะตะปัะฝัะน ะผะตัะพะด `DB.QueryRow()`:

```go
query := `
    select id, title, author, num_pages, rating from books
    where id = ?
`

bookID := 2
row := db.QueryRow(query, bookID)  // (1)
var book Book
err := row.Scan(&book.id, &book.title, &book.author, &book.numPages, &book.rating)  // (2)

if err == sql.ErrNoRows {          // (3)
fmt.Printf("no books found with id = %d\n", bookID)
} else if err != nil {             // (4)
panic(err)
} else {                           // (5)
fmt.Println(book)
}

// {2 The Fellowship of the Ring J.R.R. Tolkien 398 4.36}
//
```

`DB.QueryRow()` ะฒะพะทะฒัะฐัะฐะตั ัะบะฐะทะฐัะตะปั ะฝะฐ ัะตะทัะปััะฐั `sql.Row` โ. ะะท ะฝะตะณะพ ะผั ัะธัะฐะตะผ ะฟะพะปั ัะตัะตะท `Row.Scan()` โ ะฐะฝะฐะปะพะณะธัะฝะพ
ัะพะผั, ะบะฐะบ ะดะตะปะฐะปะธ ััะพ ะดะปั `Rows.Scan()`. ะะฐะปััะต ะฒะพะทะผะพะถะฝั ััะธ ะฒะฐัะธะฐะฝัะฐ:

- โ ะะพะดัะพะดััะธั ัััะพะบ ะฝะต ะฝะฐัะปะพัั โ ัะพะณะดะฐ `Rows.Scan()` ะฒะตัะฝะตั ะพัะธะฑะบั `sql.ErrNoRows`.
- โ ะงัะพ-ัะพ ะฟะพัะปะพ ะฝะต ัะฐะบ โ ัะพะณะดะฐ `Rows.Scan()` ะฒะตัะฝะตั ะพัะธะฑะบั ั ะพะฟะธัะฐะฝะธะตะผ ะฟัะพะฑะปะตะผั.
- โ ะัะต ะฟัะพัะปะพ ััะฟะตัะฝะพ.

ะัะปะธ ะทะฐะฟัะพั ะฒะตัะฝัะป ะฝะตัะบะพะปัะบะพ ัััะพะบ, `QueryRow()` ะฒะตัะฝะตั ัะพะปัะบะพ ะฟะตัะฒัั. ะัะธะฑะบะธ ะฟัะธ ััะพะผ ะฝะต ะฑัะดะตั.

### ะะฑัะฐะฑะพัะบะฐ NULL-ะทะฝะฐัะตะฝะธะน

ะะพะฟัััะธะผ, ะฒ ัะฐะฑะปะธัะต books ะพะบะฐะทะฐะปะฐัั ะทะฐะฟะธัั ั ะฟััััะผะธ (null) ะฟะพะปัะผะธ:

```http
โโโโโโฌโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโโ
โ id โ title โ author โ num_pages โ rating โ
โโโโโโผโโโโโโโโผโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโค
โ 6  โ       โ        โ           โ        โ
โโโโโโดโโโโโโโโดโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโ
```
ะะพะฟัะพะฑัะตะผ ะตะต ะฒัะฑัะฐัั:

```go
query := `
select id, title, author, num_pages, rating from books
where id = ?
`

var book Book
row := db.QueryRow(query, bookID)
err := row.Scan(&book.id, &book.title, &book.author, &book.numPages, &book.rating)
fmt.Println(err)
// sql: Scan error on column index 1, name "title": converting NULL to string is unsupported
```

ะะตัะพะด `Scan()` ัะปะพะผะฐะปัั, ะฟะพัะพะผั ััะพ ะฝะต ะทะฝะฐะตั, ะบะฐะบ ะฟัะตะพะฑัะฐะทะพะฒะฐัั null ะฒ ัััะพะบั (ั ัะธัะปะฐะผะธ ะธ ะดััะณะธะผะธ ัะธะฟะฐะผะธ ัะฐ ะถะต
ะฟัะพะฑะปะตะผะฐ).

ะงัะพะฑั ัะฐะฑะพัะฐัั ั null-ะทะฝะฐัะตะฝะธัะผะธ, ะฟะฐะบะตั `sql` ะฟัะตะดะพััะฐะฒะปัะตั ัะฟะตัะธะฐะปัะฝัะต ัะธะฟั-ะพะฑะตััะบะธ: `NullString`, `NullInt64`
, `NullFloat64`, `NullBool`, ะธ ัะฐะบ ะดะฐะปะตะต. ะัะพะฟะธัะตะผ ะธั ะฒ ััััะบัััะต ะบะฝะธะณะธ:

```go

type BookNullable struct {
id       int
title    sql.NullString
author   sql.NullString
numPages sql.NullInt64
rating   sql.NullFloat64
}
```

ะขะตะฟะตัั `Scan()` ะพััะฐะฑะพัะฐะตั:

```go
var bookn BookNullable
row = db.QueryRow(query, bookID)
err = row.Scan(&bookn.id, &bookn.title, &bookn.author, &bookn.numPages, &bookn.rating)
fmt.Printf("%#v %v\n", bookn, err)
/*
   main.BookNullable{
       id:6,
       title:sql.NullString{String:"", Valid:false},
       author:sql.NullString{String:"", Valid:false},
       numPages:sql.NullInt64{Int64:0, Valid:false},
       rating:sql.NullFloat64{Float64:0, Valid:false}
   }
   <nil>
*/
```

ะัะต Null-ัะธะฟั ััััะพะตะฝั ะพะดะธะฝะฐะบะพะฒะพ:

- ั ะฝะธั ะตััั ะฟะพะปะต `Valid`, ะบะพัะพัะพะต ัะฐะฒะฝะพ `false` ะดะปั null-ะทะฝะฐัะตะฝะธะน;
- ะธ ะฟะพะปะต ะบะพะฝะบัะตัะฝะพะณะพ ัะธะฟะฐ (`String`, `Int64`, `Float64`, ...) ะดะปั not null-ะทะฝะฐัะตะฝะธะน.

[ะฟะตัะพัะฝะธัะฐ](https://go.dev/play/p/g0Suvaru4ms)

> ะ ะฟะตัะพัะฝะธัะต ะฟะพะดะบะปััะตะฝะธะต ะบ ะฑะฐะทะต ะฝะต ัะฐะฑะพัะฐะตั. ะะฐะฟััะบะฐะนัะต ะปะพะบะฐะปัะฝะพ, ะตัะปะธ ัะพัะธัะต ะฟะพะฟัะพะฑะพะฒะฐัั.
>
ะะตัะพะด `Prepare` ะฒ ะฟะฐะบะตัะต `database/sql` ะฒ Go ะธัะฟะพะปัะทัะตััั ะดะปั ะฟัะตะดะฒะฐัะธัะตะปัะฝะพะน ะบะพะผะฟะธะปััะธะธ SQL ะทะฐะฟัะพัะฐ, ะบะพัะพััะน ะฑัะดะตั ะผะฝะพะณะพะบัะฐัะฝะพ ะฒัะฟะพะปะฝะตะฝ ั ัะฐะทะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ.

ะะพะณะดะฐ ะฒั ะฒัะทัะฒะฐะตัะต `Prepare` ั SQL ะทะฐะฟัะพัะพะผ, ะฑะฐะทะฐ ะดะฐะฝะฝัั ะบะพะผะฟะธะปะธััะตั ะทะฐะฟัะพั ะฒ ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะน ะฟะปะฐะฝ ะฒัะฟะพะปะฝะตะฝะธั ะธ ะฒะพะทะฒัะฐัะฐะตั ะพะฑัะตะบั `Stmt` (ะฟะพะดะณะพัะพะฒะปะตะฝะฝัะน ะทะฐะฟัะพั). ะญัะพั ะพะฑัะตะบั ะผะพะถะฝะพ ะผะฝะพะณะพะบัะฐัะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะดะปั ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะฟัะพัะฐ ั ัะฐะทะฝัะผะธ ะทะฝะฐัะตะฝะธัะผะธ ะฟะฐัะฐะผะตััะพะฒ ะฑะตะท ะฝะตะพะฑัะพะดะธะผะพััะธ ะฟะพะฒัะพัะฝะพะน ะบะพะผะฟะธะปััะธะธ ะทะฐะฟัะพัะฐ.

ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั `Prepare` ะฒ Go:

```go
stmt, err := db.Prepare("SELECT name FROM users WHERE id = ?")
if err != nil {
    log.Fatal(err)
}
defer stmt.Close()

rows, err := stmt.Query(1) // ะัะฟะพะปะฝะตะฝะธะต ะทะฐะฟัะพัะฐ ั ะฟะฐัะฐะผะตััะพะผ
if err != nil {
    log.Fatal(err)
}
defer rows.Close()

for rows.Next() {
    var name string
    err := rows.Scan(&name)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(name)
}
```

ะญัะพั ะบะพะด ะบะพะผะฟะธะปะธััะตั SQL ะทะฐะฟัะพั `SELECT name FROM users WHERE id = ?` ั ะฟะพะผะพััั ะผะตัะพะดะฐ `Prepare`, ะทะฐัะตะผ ะฒัะฟะพะปะฝัะตั ะทะฐะฟัะพั ะฝะตัะบะพะปัะบะพ ัะฐะท ั ัะฐะทะฝัะผะธ ะทะฝะฐัะตะฝะธัะผะธ ะฟะฐัะฐะผะตััะพะฒ `id`. ะญัะพ ัะฒะตะปะธัะธะฒะฐะตั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะฟัะธ ะผะฝะพะณะพะบัะฐัะฝะพะผ ะฒัะฟะพะปะฝะตะฝะธะธ ะพะดะฝะพะณะพ ะธ ัะพะณะพ ะถะต ะทะฐะฟัะพัะฐ ั ัะฐะทะฝัะผะธ ะทะฝะฐัะตะฝะธัะผะธ ะฟะฐัะฐะผะตััะพะฒ.๐๐
